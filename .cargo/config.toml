# this_file: .cargo/config.toml

[build]
# Incremental compilation
incremental = true
# Default target directory
target-dir = "target"

[target.'cfg(all())']
# Enable frame pointers for better profiling
rustflags = ["-C", "force-frame-pointers=yes"]

# Platform-specific optimizations
[target.x86_64-unknown-linux-gnu]
rustflags = ["-C", "link-arg=-fuse-ld=lld", "-C", "force-frame-pointers=yes"]

[target.x86_64-apple-darwin]
rustflags = ["-C", "force-frame-pointers=yes", "-C", "split-debuginfo=unpacked"]

[target.aarch64-apple-darwin]
rustflags = ["-C", "force-frame-pointers=yes", "-C", "split-debuginfo=unpacked"]

[target.'cfg(windows)']
rustflags = ["-C", "force-frame-pointers=yes"]

# Aliases for common commands
[alias]
# Build commands
b = "build"
br = "build --release"
ba = "build --all-features"

# Test commands
t = "test"
ta = "test --all-features"
tr = "test --release"

# Check commands
c = "check"
ca = "check --all-features"

# Clippy lints
cl = "clippy -- -D warnings"
cla = "clippy --all-features -- -D warnings"

# Documentation
d = "doc --no-deps --open"
da = "doc --all-features --no-deps --open"

# Benchmarks
bench = "bench --all-features"

# Clean and rebuild
rebuild = "build --release --clean"

# Profile-guided optimization helpers
pgo-generate = "build --release --features pgo"
pgo-use = "build --release"

[net]
# Use git CLI for fetching crates (more reliable behind proxies)
git-fetch-with-cli = true
# Retry failed downloads
retry = 3

[term]
# Enable colored output
color = "auto"

[profile.dev]
# Development profile - fast builds
opt-level = 0
debug = true
debug-assertions = true
overflow-checks = true
incremental = true
codegen-units = 256
rpath = false

[profile.release]
# Release profile - optimized for performance
opt-level = 3
debug = false
debug-assertions = false
overflow-checks = false
lto = true
codegen-units = 1
strip = true
panic = "abort"

[profile.release-with-debug]
# Release with debug symbols (for profiling)
inherits = "release"
debug = true
strip = false

[profile.bench]
# Benchmarking profile
inherits = "release"
debug = true

[profile.test]
# Test profile - balanced for speed and debuggability
opt-level = 1
debug = true
debug-assertions = true
overflow-checks = true
incremental = true

[profile.dist]
# Distribution profile - maximum optimization
inherits = "release"
opt-level = 3
lto = "fat"
codegen-units = 1
strip = true
panic = "abort"

# Reduce binary size
[profile.dist.build-override]
opt-level = "z"

[profile.dist.package."*"]
opt-level = "z"

# Platform-specific settings
[env]
# Use LLD linker on Linux for faster linking
RUSTFLAGS_LINUX = "-C link-arg=-fuse-ld=lld"

# macOS-specific settings for universal binaries
MACOSX_DEPLOYMENT_TARGET = "10.12"

# Registry configuration
[registries.crates-io]
protocol = "sparse"
