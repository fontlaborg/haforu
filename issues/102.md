

[19:33:03] $ ./build.sh
[build] Running cargo check
    Checking haforu v0.1.0 (/Users/adam/Developer/vcs/github.fontlaborg/haforu)
warning: field `max_parallel_fonts` is never read
   --> src/orchestrator.rs:157:5
    |
154 | pub struct JobOrchestrator {
    |            --------------- field in this struct
...
157 |     max_parallel_fonts: usize,
    |     ^^^^^^^^^^^^^^^^^^
    |
    = note: `#[warn(dead_code)]` on by default

warning: associated function `variations_to_map` is never used
   --> src/orchestrator.rs:551:8
    |
160 | impl JobOrchestrator {
    | -------------------- associated function in this implementation
...
551 |     fn variations_to_map(variations: &Option<Vec<VariationSetting>>) -> HashMap<String, f32> {
    |        ^^^^^^^^^^^^^^^^^

warning: field `ppem` is never read
  --> src/rasterize.rs:38:5
   |
36 | pub struct CpuRasterizer {
   |            ------------- field in this struct
37 |     /// Target pixels per em
38 |     ppem: f32,
   |     ^^^^

warning: `haforu` (lib) generated 3 warnings
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.51s
[build] Running cargo fmt + clippy
    Checking haforu v0.1.0 (/Users/adam/Developer/vcs/github.fontlaborg/haforu)
warning: field `max_parallel_fonts` is never read
   --> src/orchestrator.rs:157:5
    |
154 | pub struct JobOrchestrator {
    |            --------------- field in this struct
...
157 |     max_parallel_fonts: usize,
    |     ^^^^^^^^^^^^^^^^^^
    |
    = note: `#[warn(dead_code)]` on by default

warning: associated function `variations_to_map` is never used
   --> src/orchestrator.rs:551:8
    |
160 | impl JobOrchestrator {
    | -------------------- associated function in this implementation
...
551 |     fn variations_to_map(variations: &Option<Vec<VariationSetting>>) -> HashMap<String, f32> {
    |        ^^^^^^^^^^^^^^^^^

warning: field `ppem` is never read
  --> src/rasterize.rs:38:5
   |
36 | pub struct CpuRasterizer {
   |            ------------- field in this struct
37 |     /// Target pixels per em
38 |     ppem: f32,
   |     ^^^^

warning: use of `or_insert_with` to construct default value
   --> src/orchestrator.rs:180:18
    |
180 |                 .or_insert_with(Vec::new)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_default()`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unwrap_or_default
    = note: `#[warn(clippy::unwrap_or_default)]` on by default

warning: use of `or_insert_with` to construct default value
   --> src/orchestrator.rs:178:18
    |
178 |                 .or_insert_with(HashMap::new)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_default()`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unwrap_or_default

warning: use of `or_insert_with` to construct default value
   --> src/orchestrator.rs:263:18
    |
263 |                 .or_insert_with(Vec::new)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_default()`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unwrap_or_default

warning: use of `or_insert_with` to construct default value
   --> src/orchestrator.rs:261:18
    |
261 |                 .or_insert_with(HashMap::new)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_default()`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unwrap_or_default

warning: casting to the same type is unnecessary (`i32` -> `i32`)
   --> src/rasterize.rs:215:25
    |
215 |                 let y = (min_top - glyph.top) as i32;
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `(min_top - glyph.top)`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unnecessary_cast
    = note: `#[warn(clippy::unnecessary_cast)]` on by default

warning: redundant closure
  --> src/security.rs:47:22
   |
47 |             .map_err(|e| Error::Io(e))?
   |                      ^^^^^^^^^^^^^^^^ help: replace the closure with the function itself: `Error::Io`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure
   = note: `#[warn(clippy::redundant_closure)]` on by default

warning: this `if` statement can be collapsed
   --> src/shaping.rs:238:9
    |
238 | /         if feature_str.len() == 4 && feature_str.contains('=') {
239 | |             if let Some(pos) = feature_str.find('=') {
240 | |                 let value_str = &feature_str[pos + 1..];
241 | |                 if value_str.parse::<f32>().is_ok() {
...   |
245 | |         }
    | |_________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#collapsible_if
    = note: `#[warn(clippy::collapsible_if)]` on by default
help: collapse nested if block
    |
238 ~         if feature_str.len() == 4 && feature_str.contains('=')
239 ~             && let Some(pos) = feature_str.find('=') {
240 |                 let value_str = &feature_str[pos + 1..];
...
243 |                 }
244 ~             }
    |

warning: stripping a prefix manually
   --> src/shaping.rs:253:14
    |
253 |             (&feature_str[1..], 0)
    |              ^^^^^^^^^^^^^^^^^
    |
note: the prefix was tested here
   --> src/shaping.rs:252:16
    |
252 |         } else if feature_str.starts_with('-') {
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#manual_strip
    = note: `#[warn(clippy::manual_strip)]` on by default
help: try using the `strip_prefix` method
    |
252 ~         } else if let Some(<stripped>) = feature_str.strip_prefix('-') {
253 ~             (<stripped>, 0)
    |

warning: stripping a prefix manually
   --> src/shaping.rs:255:14
    |
255 |             (&feature_str[1..], 1)
    |              ^^^^^^^^^^^^^^^^^
    |
note: the prefix was tested here
   --> src/shaping.rs:254:16
    |
254 |         } else if feature_str.starts_with('+') {
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#manual_strip
help: try using the `strip_prefix` method
    |
254 ~         } else if let Some(<stripped>) = feature_str.strip_prefix('+') {
255 ~             (<stripped>, 1)
    |

warning: `assert!(true)` will be optimized out by the compiler
   --> src/shaping.rs:313:9
    |
313 |         assert!(true);
    |         ^^^^^^^^^^^^^
    |
    = help: remove it
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#assertions_on_constants
    = note: `#[warn(clippy::assertions_on_constants)]` on by default

warning: `assert!(true)` will be optimized out by the compiler
   --> src/shaping.rs:357:9
    |
357 |         assert!(true);
    |         ^^^^^^^^^^^^^
    |
    = help: remove it
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#assertions_on_constants

warning: `haforu` (lib) generated 12 warnings (run `cargo clippy --fix --lib -p haforu` to apply 7 suggestions)
warning: useless use of `vec!`
   --> src/storage.rs:369:39
    |
369 |         let id1 = manager.store_image(&vec![1u8; 100], 10, 10).unwrap();
    |                                       ^^^^^^^^^^^^^^^ help: you can use a slice directly: `&[1u8; 100]`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#useless_vec
    = note: `#[warn(clippy::useless_vec)]` on by default

warning: useless use of `vec!`
   --> src/storage.rs:370:39
    |
370 |         let id2 = manager.store_image(&vec![2u8; 100], 10, 10).unwrap();
    |                                       ^^^^^^^^^^^^^^^ help: you can use a slice directly: `&[2u8; 100]`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#useless_vec

warning: useless use of `vec!`
   --> src/storage.rs:371:39
    |
371 |         let id3 = manager.store_image(&vec![3u8; 100], 10, 10).unwrap();
    |                                       ^^^^^^^^^^^^^^^ help: you can use a slice directly: `&[3u8; 100]`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#useless_vec

warning: `haforu` (lib test) generated 15 warnings (10 duplicates) (run `cargo clippy --fix --lib -p haforu --tests` to apply 3 suggestions)
warning: use of deprecated associated function `assert_cmd::Command::cargo_bin`: incompatible with a custom cargo build-dir, see instead `cargo::cargo_bin_cmd!`
  --> tests/cli.rs:10:14
   |
10 |     Command::cargo_bin("haforu").expect("binary exists")
   |              ^^^^^^^^^
   |
   = note: `#[warn(deprecated)]` on by default

warning: unused import: `assert_cmd::prelude`
 --> tests/cli.rs:5:5
  |
5 | use assert_cmd::prelude::*;
  |     ^^^^^^^^^^^^^^^^^^^
  |
  = note: `#[warn(unused_imports)]` on by default

warning: length comparison to zero
  --> tests/e2e_shaping_rendering.rs:33:13
   |
33 |     assert!(shaped.glyphs.len() > 0, "expected some glyphs for 'Hello'");
   |             ^^^^^^^^^^^^^^^^^^^^^^^ help: using `!is_empty` is clearer and more explicit: `!shaped.glyphs.is_empty()`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#len_zero
   = note: `#[warn(clippy::len_zero)]` on by default

warning: `haforu` (test "cli") generated 2 warnings
warning: field assignment outside of initializer for an instance created with Default::default()
  --> tests/e2e_shaping_rendering.rs:61:5
   |
61 |     opts.script = Some("Deva".to_string());
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
note: consider initializing the variable with `haforu::json_parser::ShapingOptions { script: Some("Deva".to_string()), direction: "ltr".to_string(), ..Default::default() }` and removing relevant reassignments
  --> tests/e2e_shaping_rendering.rs:60:5
   |
60 |     let mut opts = ShapingOptions::default();
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#field_reassign_with_default
   = note: `#[warn(clippy::field_reassign_with_default)]` on by default

warning: length comparison to zero
  --> tests/e2e_shaping_rendering.rs:73:9
   |
73 |         shaped.glyphs.len() > 0,
   |         ^^^^^^^^^^^^^^^^^^^^^^^ help: using `!is_empty` is clearer and more explicit: `!shaped.glyphs.is_empty()`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#len_zero

warning: useless use of `format!`
  --> tests/integration_test.rs:75:16
   |
75 |       let json = format!(
   |  ________________^
76 | |         r#"{{
77 | |         "version": "1.0.0",
78 | |         "jobs": [{{
...  |
94 | |     }}"#
95 | |     );
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#useless_format
   = note: `#[warn(clippy::useless_format)]` on by default
help: consider using `.to_string()`
   |
75 ~     let json = r#"{
76 +         "version": "1.0.0",
77 +         "jobs": [{
78 +             "id": "test_job",
79 +             "font": {
80 +                 "path": "03fonts/Archivo[wdth,wght].ttf",
81 +                 "variations": [
82 +                     {"tag": "wght", "value": 400},
83 +                     {"tag": "wdth", "value": 100}
84 +                 ]
85 +             },
86 +             "text": "Test Text",
87 +             "size": 24.0
88 +         }],
89 +         "storage": {
90 +             "backend": "filesystem",
91 +             "output_path": "./test_output"
92 +         }
93 ~     }"#.to_string();
   |

warning: `haforu` (test "e2e_shaping_rendering") generated 3 warnings (run `cargo clippy --fix --test "e2e_shaping_rendering"` to apply 2 suggestions)
warning: `haforu` (test "integration_test") generated 1 warning (run `cargo clippy --fix --test "integration_test"` to apply 1 suggestion)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 1.11s
[build] Running cargo test
   Compiling haforu v0.1.0 (/Users/adam/Developer/vcs/github.fontlaborg/haforu)
warning: field `max_parallel_fonts` is never read
   --> src/orchestrator.rs:157:5
    |
154 | pub struct JobOrchestrator {
    |            --------------- field in this struct
...
157 |     max_parallel_fonts: usize,
    |     ^^^^^^^^^^^^^^^^^^
    |
    = note: `#[warn(dead_code)]` on by default

warning: associated function `variations_to_map` is never used
   --> src/orchestrator.rs:551:8
    |
160 | impl JobOrchestrator {
    | -------------------- associated function in this implementation
...
551 |     fn variations_to_map(variations: &Option<Vec<VariationSetting>>) -> HashMap<String, f32> {
    |        ^^^^^^^^^^^^^^^^^

warning: field `ppem` is never read
  --> src/rasterize.rs:38:5
   |
36 | pub struct CpuRasterizer {
   |            ------------- field in this struct
37 |     /// Target pixels per em
38 |     ppem: f32,
   |     ^^^^

warning: `haforu` (lib) generated 3 warnings (1 duplicate)
warning: `haforu` (lib test) generated 1 warning
warning: use of deprecated associated function `assert_cmd::Command::cargo_bin`: incompatible with a custom cargo build-dir, see instead `cargo::cargo_bin_cmd!`
  --> tests/cli.rs:10:14
   |
10 |     Command::cargo_bin("haforu").expect("binary exists")
   |              ^^^^^^^^^
   |
   = note: `#[warn(deprecated)]` on by default

warning: unused import: `assert_cmd::prelude`
 --> tests/cli.rs:5:5
  |
5 | use assert_cmd::prelude::*;
  |     ^^^^^^^^^^^^^^^^^^^
  |
  = note: `#[warn(unused_imports)]` on by default

warning: `haforu` (test "cli") generated 2 warnings
    Finished `test` profile [unoptimized + debuginfo] target(s) in 1.82s
     Running unittests src/lib.rs (target/debug/deps/haforu-aea9b0084d855bba)

running 45 tests
test font_loader::tests::test_invalid_font_signatures ... ok
test font_loader::tests::test_font_loader_creation ... ok
test font_loader::tests::test_cache_operations ... ok
test font_loader::tests::test_valid_font_signatures ... ok
test font_loader::tests::test_load_nonexistent_file ... ok
test logging::tests::test_default_level ... ok
test logging::tests::test_timer_creation ... ok
test json_parser::tests::test_validate_empty_jobs ... ok
test json_parser::tests::test_parse_job_with_variations ... ok
test json_parser::tests::test_validate_invalid_size ... ok
test json_parser::tests::test_parse_valid_job_spec ... ok
test json_parser::tests::test_validate_invalid_direction ... ok
test json_parser::tests::test_serialize_job_result ... ok
test mmap_font::tests::test_font_type_detection ... ok
test mmap_font::tests::test_font_type_is_collection ... ok
test mmap_font::tests::test_mmap_cache ... ok
test orchestrator::tests::test_font_cache_metrics_hit_miss ... ok
test orchestrator::tests::test_instance_key ... ok
test orchestrator::tests::test_parallelization_strategy ... ok
test rasterize::tests::test_cpu_rasterizer_creation ... ok
test orchestrator::tests::test_job_analysis ... ok
test rasterize::tests::test_empty_render ... ok
test rasterize::tests::test_parallel_rasterizer ... ok
test rasterize::tests::test_subpixel_precision ... ok
test security::tests::test_font_size_validation ... ok
test mmap_font::tests::test_empty_file_error ... ok
test font_loader::tests::test_load_empty_file ... ok
test security::tests::test_memory_monitor ... ok
test orchestrator::tests::test_font_cache_lru ... ok
test security::tests::test_path_sanitization_rejects_traversal ... ok
test font_loader::tests::test_load_invalid_font_file ... ok
test security::tests::test_text_validation ... ok
test shaping::tests::test_parse_direction ... ok
test shaping::tests::test_parse_script ... ok
test shaping::tests::test_placeholder_shaping ... ok
test shaping::tests::test_shaping_options_default ... ok
test shaping::tests::test_text_shaper_creation ... ok
test storage::tests::test_index_entry_size ... ok
test mmap_font::tests::test_invalid_font_file ... ok
test storage::tests::test_storage_manager_creation ... ok
test security::tests::test_path_sanitization_with_base_dir ... ok
test security::tests::test_json_size_validation ... ok
test security::tests::test_timeout_guard ... ok
test storage::tests::test_store_and_retrieve_image ... ok
test storage::tests::test_shard_rotation ... ok

test result: ok. 45 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.06s

     Running unittests src/main.rs (target/debug/deps/haforu-2b92dcc2f62490bf)

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

     Running tests/cli.rs (target/debug/deps/cli-e06dd7cb61b72571)

running 3 tests
test test_cli_version_prints ... ok
test test_cli_validate_accepts_valid_json ... ok
test test_cli_process_emits_jsonl ... ok

test result: ok. 3 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.03s

     Running tests/e2e_shaping_rendering.rs (target/debug/deps/e2e_shaping_rendering-25a6783e019e785e)

running 3 tests
test test_shape_and_render_archivo_hello_line ... ok
test test_shape_devanagari_basic ... ok
test test_storage_roundtrip_with_render ... ok

test result: ok. 3 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.03s

     Running tests/integration_test.rs (target/debug/deps/integration_test-e7490f7009090b24)

running 7 tests
test test_invalid_font_path_handling ... ok
test test_json_spec_with_real_font_paths ... ok
test test_multiple_fonts_in_job_spec ... ok
test test_load_archivo_variable_font ... ok
test test_font_caching ... ok
test test_load_merriweather_variable_font ... ok
test test_font_validation_with_all_test_fonts ... ok

test result: ok. 7 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.01s

   Doc-tests haforu

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

[build] Building Rust crate
   Compiling haforu v0.1.0 (/Users/adam/Developer/vcs/github.fontlaborg/haforu)
warning: field `max_parallel_fonts` is never read
   --> src/orchestrator.rs:157:5
    |
154 | pub struct JobOrchestrator {
    |            --------------- field in this struct
...
157 |     max_parallel_fonts: usize,
    |     ^^^^^^^^^^^^^^^^^^
    |
    = note: `#[warn(dead_code)]` on by default

warning: associated function `variations_to_map` is never used
   --> src/orchestrator.rs:551:8
    |
160 | impl JobOrchestrator {
    | -------------------- associated function in this implementation
...
551 |     fn variations_to_map(variations: &Option<Vec<VariationSetting>>) -> HashMap<String, f32> {
    |        ^^^^^^^^^^^^^^^^^

warning: field `ppem` is never read
  --> src/rasterize.rs:38:5
   |
36 | pub struct CpuRasterizer {
   |            ------------- field in this struct
37 |     /// Target pixels per em
38 |     ppem: f32,
   |     ^^^^

warning: `haforu` (lib) generated 3 warnings
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 2.23s
[build] Building Python wheels (maturin)
    Updating crates.io index
error: failed to select a version for the requirement `read-fonts = "^0.35.1"`
  version 0.35.1 is yanked
location searched: crates.io index
required by package `haforu v0.1.0 (/Users/adam/Developer/vcs/github.fontlaborg/haforu)`
    ... which satisfies path dependency `haforu` of package `haforu-py v0.1.0 (/Users/adam/Developer/vcs/github.fontlaborg/haforu/bindings/python)`
ðŸ’¥ maturin failed
  Caused by: Cargo metadata failed. Does your crate compile with `cargo build`?
  Caused by: `cargo metadata` exited with an error:
~/Developer/vcs/github.fontlaborg/haforu
[19:33:16] $